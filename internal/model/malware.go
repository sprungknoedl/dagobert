package model

type Malware struct {
	ID       string
	Status   string
	Path     string
	Hash     string
	Notes    string
	CaseID   string
	RawAsset []byte `gorm:"-"`

	AssetID string
	Asset   Asset
}

func (Malware) TableName() string { return "malware" }

func (store *Store) ListMalware(cid string) ([]Malware, error) {
	list := []Malware{}
	tx := store.DB.
		Preload("Asset").
		Where("case_id = ?", cid).
		Order("path asc").
		Find(&list)
	return list, tx.Error
}

func (store *Store) GetMalware(cid string, id string) (Malware, error) {
	obj := Malware{}
	tx := store.DB.
		Preload("Asset").
		First(&obj, "id = ?", id)
	return obj, tx.Error
}

func (store *Store) SaveMalware(cid string, obj Malware) error {
	return store.DB.
		Omit("Asset.*").
		Save(obj).
		Error
}

func (store *Store) DeleteMalware(cid string, id string) error {
	return store.DB.Delete(&Malware{}, "id = ?", id).Error
}
